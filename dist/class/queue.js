import{debugLog as t}from"../utils/index.js";class s{tasks=[];max=0;total=0;delay=0;done;constructor(t){let{max:s=5,done:a,delay:i=0}=t;this.tasks=[],this.total=0,this.max=s,this.done=a,this.delay=i,setTimeout((()=>{this.run()}),0)}addTask(t){this.tasks.push(t),this.total+=1}run(){if(0===this.tasks.length)return Promise.resolve("");const s=Math.min(this.tasks.length,this.max);for(let a=0;a<s;a+=1)this.max-=1,this.tasks.shift()().then((()=>{})).catch((s=>{t("error",s)})).finally((()=>{setTimeout((()=>{this.max+=1,this.total-=1,this.run(),0===this.total&&this.done?.()}),this.delay)}))}}export{s as ConcurrentPoll};
